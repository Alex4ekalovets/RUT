## Сервис распознавания образов
## Содержание
<!-- TOC -->
  * [Сервис распознавания образов](#сервис-распознавания-образов)
  * [Содержание](#содержание)
  * [Основные функции](#основные-функции)
  * [Установка и настройка](#установка-и-настройка)
    * [Локальный запуск без Docker](#локальный-запуск-без-docker)
    * [Запуск в Docker контейнере](#запуск-в-docker-контейнере)
  * [Используемые технологии](#используемые-технологии)
  * [Использование сервиса](#использование-сервиса)
    * [Сервис обработки изображений](#сервис-обработки-изображений)
    * [Сервис обработки изображений](#сервис-обработки-изображений-1)
  * [Тестирование сервиса](#тестирование-сервиса)
<!-- TOC -->


## Основные функции

* Обработка изображений: изменение размера, поворот, обрезка, размытие, цветность
* Распознавание образов: обнаружение лиц на изображении

## Установка и настройка

### Локальный запуск без Docker
1. Скопируйте файлы проекта
```commandline
git clone https://github.com/Alex4ekalovets/RUT.git
```

2. Настройте виртуальное окружение

* В папке с проектом создайте виртуальное окружение
```commandline
python3.10 -m venv venv
```
* Активируйте виртуальное окружение
```commandline
source env/bin/activate
```
3. Установите зависимости в виртуальное окружение:
```commandline
pip install -r requirements.txt
```
4. Запустите локальный сервер командой
```commandline
uvicorn app:app --reload
```
### Запуск в Docker контейнере
1. Скопируйте файлы проекта
```commandline
git clone https://github.com/Alex4ekalovets/RUT.git
```
2. Создайте Docker образ
```commandline
docker-compose build
```
3. Запустите Docker контейнер
```commandline
docker-compose up
```
Сервер запустится на порту 8000

## Используемые технологии
* Python 3.10
* opencv-python 4.9.0.80
* fastapi 0.110.0
* Docker
* bootstrap 4
* colorlog 6.8.2
* imutils 0.5.4
* pytest 8.1.1

## Использование сервиса
Документация Swagger (при локальном запуске): 
* http://localhost:8000/image_tools/docs#/, 
* http://localhost:8000/detection/docs#/

Сервисы обработки изображений и обнаружения лиц смонтированы в одно общее приложение для удобства запуска

### Сервис обработки изображений
Инструменты для обработки изображений расположены в модуле utils/image_tools.py
Класс ImageHandlers содержит функции обработчики. 
Функция image_handler принимает путь к файлу, класс обработчиков и kwargs, где ключ - имя обработчика,
значение - аргументы функции-обработчика и применяет последовательно указанные обработчики к исходному файлу.

Для демонстрации работы сервиса обработки изображений реализовано web-приложение, расположенное в модуле app/image_tools_app.py
Страница web-приложения: http://localhost:8000/image_tools/
Пользователь загружает изображение, изменяет параметры изображения (размер, поворот, обрезка, размытие, цветность) 
(изменения происходят динамически при каждом изменении параметра), сохраняет измененное изображения.

### Сервис обработки изображений
Инструменты обнаружения объектов на изображениях расположены в модуле utils/detection.py
Объект класса Detector быть создан c любой моделью для CascadeClassifier библиотеки OpenCV.
В качестве примера объектов распознавания выбраны лица людей для чего был создан дочерний класс FaceDetector, 
и по умолчанию передана модель 'haarcascade_frontalface_alt.xml'
Функция detect_faces_and_save обнаруживает на переданных изображениях лица и сохраняет их в файлы под новым путем.

Для демонстрации работы сервиса обнаружения лиц на изображениях реализовано web-приложение, расположенное в модуле app/detection.py
Страница web-приложения: http://localhost:8000/detection/
Пользователь загружает изображения, нажимает кнопку 'Detect Faces'. Результаты распознавания отображаются на странице

## Тестирование сервиса
Предусмотрено частичное покрытие сервиса unit тестами.
Тест кейсы расположены в директории tests.
Модуль detect протестирован на частичном датасете IMDB-Wiki (3113 лиц) с fps 23.22
https://data.vision.ee.ethz.ch/cvl/rrothe/imdb-wiki/static/wiki_crop.tar
Запуск тестов из корневой директории проекта:
```commandline
pytest
```